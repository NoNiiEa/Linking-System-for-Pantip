import pythainlp
from .utils import clean_text
from pythainlp.tokenize import word_tokenize

text_title = """
à¸—à¸³à¹„à¸¡à¸–à¸¶à¸‡à¸Šà¸­à¸š à¸à¸´à¸™à¹„à¸à¹ˆà¸—à¸­à¸”à¸œà¸¹à¹‰à¸žà¸±à¸™ à¸à¸±à¸™à¸„à¸£à¸±à¸š
 à¸—à¸³à¹„à¸¡à¸–à¸¶à¸‡à¸Šà¸­à¸šà¸à¸´à¸™à¹„à¸à¹ˆà¸—à¸­à¸”à¸œà¸¹à¹‰à¸žà¸±à¸™ KFC à¸à¸±à¸™à¸„à¸£à¸±à¸š
  à¸ªà¸‡à¸ªà¸±à¸¢à¸•à¸±à¸§à¹€à¸­à¸‡à¸¡à¸²à¸ à¸žà¸¢à¸²à¸¢à¸²à¸¡à¸‡à¸”à¸‚à¸­à¸‡à¸—à¸­à¸” à¹à¸•à¹ˆà¸•à¸°à¸šà¸°à¹à¸•à¸à¸—à¸¸à¸à¸—à¸µ à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸™à¸£à¹‰à¸²à¸™à¹„à¸à¹ˆà¸—à¸­à¸” KFC

à¸œà¸¡à¸žà¸¢à¸²à¸¢à¸²à¸¡à¸¥à¸”à¸™à¹‰à¸³à¸«à¸™à¸±à¸à¹à¸¥à¹‰à¸§à¸™à¸° à¸žà¸­à¸¥à¸”à¸¥à¸‡à¸¡à¸²à¹„à¸”à¹‰   à¸¡à¸±à¸™à¸ˆà¸°à¸¡à¸µà¸Šà¸µà¸—à¹€à¸”à¸¢à¹Œà¹„à¸‡  à¸à¹‡à¹„à¸›à¹ƒà¸ˆà¹à¸•à¸à¸à¸±à¸šà¹„à¸à¹ˆà¸—à¸­à¸”à¸£à¹‰à¸²à¸™à¸™à¸µà¹‰à¸•à¸¥à¸­à¸”à¹€à¸¥à¸¢ à¹€à¸¡à¸·à¹ˆà¸­à¸§à¸²à¸™à¸™à¸±
à¸à¹‡à¹€à¸žà¸´à¹ˆà¸‡à¹‚à¸”à¸™à¹„à¸›à¸¡à¸²à¸”à¹† à¸„à¸£à¸±à¸š   à¹ƒà¸„à¸£à¹€à¸›à¹‡à¸™à¸šà¹‰à¸²à¸‡ à¹€à¸žà¸£à¸²à¸°à¸­à¸°à¹„à¸£à¹€à¸¥à¹ˆà¸²à¹ƒà¸«à¹‰à¸Ÿà¸±à¸‡à¸à¸±à¸™à¸šà¹‰à¸²à¸‡à¸„à¸£à¸±à¸š
à¸™à¹ˆà¸²à¸ˆà¸°à¹€à¸›à¹‡à¸™à¹€à¸žà¸£à¸²à¸°à¸à¸¥à¸´à¹ˆà¸™à¸«à¸­à¸¡à¹€à¸‰à¸žà¸²à¸°à¸•à¸±à¸§à¸‚à¸­à¸‡à¹„à¸à¹ˆà¸—à¸­à¸”à¹à¸™à¹ˆà¹†
à¸£à¸ªà¸Šà¸²à¸•à¸´à¹€à¸‚à¹‰à¸¡à¸‚à¹‰à¸™ à¹à¸‹à¹ˆà¸šà¸à¸³à¸¥à¸±à¸‡à¸”à¸µ à¸­à¸±à¸™à¸™à¸µà¹‰à¸¡à¸µà¸£à¸ªà¹€à¸›à¸£à¸µà¹‰à¸¢à¸§à¹† à¹€à¸œà¹‡à¸”à¹† à¸•à¹‰à¸­à¸‡à¸”à¸·à¹ˆà¸¡à¸£à¸µà¸Ÿà¸´à¸§à¸•à¸²à¸¡à¹€à¸¥à¸¢ à¸œà¸¡à¹€à¸­à¸²à¸ªà¸¥à¸±à¸”à¸œà¸±à¸à¹„à¸›à¹à¸à¸¥à¹‰à¸¡à¸”à¹‰à¸§à¸¢
à¸„à¸§à¸²à¸¡à¸à¸£à¸¸à¸šà¸à¸£à¸­à¸šà¸—à¸¸à¸à¸„à¸³à¸—à¸µà¹ˆà¹€à¸„à¸µà¹‰à¸¢à¸§à¸«à¸™à¸±à¸‡à¹„à¸à¹ˆ
à¸„à¸§à¸²à¸¡à¹€à¸„à¹‡à¸¡à¸¡à¸±à¸™à¸¥à¸‡à¸•à¸±à¸§ à¹€à¸™à¸·à¹‰à¸­à¹„à¸à¹ˆà¸™à¸¸à¹ˆà¸¡à¸¡à¸²à¸à¸¡à¸µà¸à¸¥à¸´à¹ˆà¸™à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¹€à¸—à¸¨à¸–à¸¶à¸‡à¸‚à¹‰à¸²à¸‡à¹ƒà¸™
à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸ à¸à¸´à¸™à¹ƒà¸™à¸£à¹‰à¸²à¸™à¸¡à¸±à¸™à¸ˆà¸°à¸£à¹‰à¸­à¸™à¸à¸³à¸¥à¸±à¸‡à¸”à¸µ à¸¡à¸µà¹à¸­à¸£à¹Œà¹€à¸¢à¹‡à¸™à¹€à¸›à¹ˆà¸²à¸™à¸±à¹ˆà¸‡à¸ªà¸šà¸²à¸¢à¸”à¹‰à¸§à¸¢

à¸‚à¹‰à¸­à¹€à¸ªà¸µà¸¢à¸„à¸·à¸­ à¸Šà¸´à¹‰à¸™à¹€à¸¥à¹‡à¸à¹„à¸›à¸™à¸´à¸” à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸§à¸±à¸™à¸­à¸±à¸‡à¸„à¸²à¸£ à¸à¹‡à¹€à¸à¸·à¸­à¸šà¸«à¸¡à¸”à¸•à¸±à¸§à¹€à¸¥à¸¢

à¸›à¸¥ à¹„à¸›à¸à¸´à¸™à¸—à¸µà¹ˆà¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™à¹„à¸¡à¹ˆà¸Ÿà¸´à¸™à¹€à¸—à¹ˆà¸²à¸—à¸µà¹ˆà¹€à¸¡à¸·à¸­à¸‡à¹„à¸—à¸¢
"""
text_comment = """
à¸Šà¸­à¸šà¹€à¸žà¸£à¸²à¸°à¸«à¸™à¸±à¸‡à¹„à¸à¹ˆà¸à¸£à¸­à¸šà¸¡à¸²à¸à¸à¸à¸à¸„à¹ˆà¸° à¹€à¸£à¸²à¸™à¸µà¹ˆà¸¥à¸­à¸à¸à¸´à¸™à¸«à¸™à¸±à¸‡à¸à¹ˆà¸­à¸™à¹€à¸¥à¸¢ 5555
à¸¡à¸±à¸™à¸«à¸²à¸à¸´à¸™à¸‡à¹ˆà¸²à¸¢à¸”à¹‰à¸§à¸¢à¸¡à¸±à¹‰à¸‡à¸„à¸° à¹€à¸”à¸µà¹‹à¸¢à¸§à¸™à¸µà¹‰à¸¡à¸µà¸™à¹‰à¸³à¸£à¸µà¸Ÿà¸µà¸¥à¹€à¸à¸·à¸­à¸šà¸—à¸¸à¸à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¸”à¹‰à¸§à¸¢ à¹€à¸£à¸²à¸§à¹ˆà¸²à¸„à¸¸à¹‰à¸¡
à¸Šà¸­à¸šà¸§à¸´à¹‰à¸‡à¹à¸‹à¹ˆà¸šà¸ªà¸¸à¸”à¹à¸¥à¹‰à¸§à¸à¸±à¸šà¹€à¸Ÿà¸£à¸™à¸‹à¹Œà¸Ÿà¸£à¸²à¸¢à¸„à¹ˆà¸° à¹„à¸à¹ˆà¸—à¸­à¸”à¸™à¸µà¹ˆà¹€à¸£à¸²à¹à¸—à¸šà¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸à¸´à¸™à¸¥à¸°à¹€à¸žà¸£à¸²à¸°à¸¡à¸±à¸™à¹€à¸¥à¹‡à¸à¹„à¸¡à¹ˆà¸­à¸´à¹ˆà¸¡ à¸à¸´à¸™à¹€à¸›à¹‡à¸™à¸Šà¸¸à¸”à¸‚à¹‰à¸²à¸§à¸à¸±à¸šà¸§à¸´à¹‰à¸‡à¹à¸‹à¹ˆà¸šà¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸”à¸µà¸¢à¸§à¹€à¸¥à¸¢ 
à¸œà¸¡à¸à¹‡à¸Šà¸­à¸šà¹€à¸žà¸£à¸²à¸°à¸¡à¸±à¸™à¸à¸£à¸­à¸š à¹€à¸™à¸·à¹‰à¸­à¸™à¸¸à¹ˆà¸¡ à¹€à¸Ÿà¸£à¸™à¸Šà¹Œà¸Ÿà¸£à¸²à¸¢à¸”à¹Œà¸à¹‡à¸­à¸£à¹ˆà¸­à¸¢ à¹‚à¸”à¸¢à¹€à¸‰à¸žà¸²à¸°à¸¡à¸±à¸™à¸šà¸”à¸„à¸£à¸±à¸š 
à¸­à¸£à¹ˆà¸­à¸¢ à¹à¸¥à¸°à¸‚à¸­à¸‡à¸—à¸­à¸”à¸à¸±à¸šà¹€à¸£à¸² à¸¡à¸±à¸™à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸à¸´à¸”à¸¡à¸²à¸„à¸¹à¹ˆà¸à¸±à¸™à¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§
à¸œà¸¡à¸à¹‡à¸Šà¸­à¸š à¹à¸•à¹ˆà¸à¸´à¸™à¹à¸„à¹ˆà¸›à¸µà¸™à¸¶à¸‡ 2-3 à¸„à¸£à¸±à¹‰à¸‡à¸žà¸­à¹à¸¥à¹‰à¸§
à¸¥à¸¹à¸à¸œà¸¡à¸à¸´à¸™à¹„à¸à¹ˆà¸—à¸­à¸”à¸—à¸±à¹ˆà¸§à¹„à¸› à¸Šà¸´à¹‰à¸™à¸™à¸¶à¸‡à¸šà¸²à¸‡à¸—à¸µà¸à¹‡à¹„à¸¡à¹ˆà¸«à¸¡à¸”
à¸–à¹‰à¸²à¹„à¸à¹ˆà¸œà¸¹à¹‰à¸žà¸±à¸™ 3 à¸Šà¸´à¹‰à¸™à¹„à¸¡à¹ˆà¹€à¸«à¸¥à¸·à¸­
à¸­à¸²à¸ˆà¸ˆà¸°à¹€à¸›à¹‡à¸™à¸£à¸ªà¸Šà¸²à¸•à¸´à¸—à¸µà¹ˆà¸„à¸¸à¹‰à¸™à¹€à¸„à¸¢  à¹à¸¥à¸°à¸à¹‡à¹€à¸›à¹‡à¸™à¸„à¸§à¸²à¸¡à¹€à¸„à¸¢à¸Šà¸´à¸™à¸—à¸µà¹ˆà¸•à¸´à¸”à¸¥à¸´à¹‰à¸™à¸¡à¸²à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆà¸£à¸¹à¹‰à¸ˆà¸±à¸à¹„à¸à¹ˆ KFC 
à¹à¸¥à¹‰à¸§à¸à¹‡à¸à¸¥à¸±à¸§à¸£à¹‰à¸²à¸™à¹€à¸‚à¸²à¸­à¸¢à¸¹à¹ˆà¹„à¸¡à¹ˆà¹„à¸”à¹‰  à¹„à¸›à¹€à¸à¸·à¸­à¸šà¸—à¸¸à¸à¸­à¸±à¸‡à¸„à¸²à¸£à¹€à¸¥à¸¢à¸„à¹ˆà¸°
à¹€à¸§à¸¥à¸²à¹„à¸›à¸à¸´à¸™à¹„à¸à¹ˆà¸œà¸¹à¹‰à¸žà¸±à¸™à¸œà¸¡à¸ˆà¸°à¸à¸´à¸™à¹à¸•à¹ˆà¸§à¸´à¹‰à¸‡à¹à¸‹à¹ˆà¸š à¹„à¸à¹ˆà¸—à¸­à¸”à¹à¸šà¸šà¸›à¸à¸•à¸´à¸œà¸¡à¹„à¸¡à¹ˆà¸à¸´à¸™à¹€à¸¥à¸¢
à¹€à¸žà¸£à¸²à¸°à¸£à¸ªà¸Šà¸²à¸•à¸´à¹à¸£à¸‡ à¹à¸¥à¸°à¸ˆà¸±à¸”à¸ˆà¹‰à¸²à¸™à¸”à¸µ à¸šà¸§à¸à¸à¸±à¸šà¸‹à¸­à¸ªà¸žà¸£à¸´à¸à¸‹à¸­à¸ªà¸¡à¸°à¹€à¸‚à¸·à¸­à¹€à¸—à¸¨
à¹€à¸­à¸²à¸¡à¸²à¹€à¸—à¸µà¸¢à¸šà¸à¸±à¸šà¹„à¸à¹ˆà¸¢à¹ˆà¸²à¸‡à¸«à¸²à¸”à¹ƒà¸«à¸à¹ˆ à¹„à¸à¹ˆà¸—à¸­à¸”à¸‚à¸­à¸‡à¸«à¹‰à¸²à¸”à¸²à¸§ à¸¡à¸±à¸™à¸à¹‡à¸­à¸£à¹ˆà¸­à¸¢à¸à¸§à¹ˆà¸²à¹à¸™à¹ˆà¹†à¹à¸•à¹ˆà¸—à¸µà¹ˆà¹à¸žà¹‰à¸„à¸·à¸­à¸‚à¸™à¸²à¸” 55+
à¸Šà¸­à¸šà¸™à¸±à¸à¹€à¸à¹‡à¸• + à¸‹à¸­à¸ªà¸«à¸§à¸²à¸™à¹†
à¸œà¸¡à¸à¸´à¸™à¸—à¸µà¹„à¸£à¸™à¸µà¹ˆà¹€à¸à¹‡à¸šà¹€à¸£à¸µà¸¢à¸šà¹€à¸¥à¸¢à¸„à¸£à¸±à¸š à¹à¸¡à¹‰à¹à¸•à¹ˆà¹€à¸¨à¸©à¹à¸›à¹‰à¸‡à¸—à¸­à¸”à¸—à¸µà¹ˆà¸«à¸¥à¸¸à¸”à¸ˆà¸²à¸à¸«à¸™à¸±à¸‡à¹„à¸à¹ˆ à¹à¸¥à¸°à¹„à¸¡à¹ˆà¸Šà¸­à¸šà¸™à¸±à¹ˆà¸‡à¸à¸´à¸™à¸—à¸µà¹ˆà¸£à¹‰à¸²à¸™ à¸ˆà¸°à¸ªà¸±à¹ˆà¸‡à¸¡à¸²à¸à¸´à¸™à¸—à¸µà¹ˆà¸šà¹‰à¸²à¸™ (à¸à¸¥à¸±à¸‡à¸„à¸™à¸­à¸·à¹ˆà¸™à¹€à¸«à¹‡à¸™à¸§à¹ˆà¸²à¸à¸´à¸™à¸¡à¸¹à¸¡à¸¡à¸²à¸¡ 555 ðŸ˜ðŸ˜ðŸ˜)
à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸›à¸£à¸¸à¸‡à¸—à¸µà¹ˆà¸«à¸¡à¸±à¸à¹ƒà¸™à¹„à¸à¹ˆà¸„à¸£à¸±à¸š  hot&spicy à¹€à¸ˆà¹‰à¸²à¸™à¸µà¹‰ à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸„à¸£à¸—à¸³à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸¥à¸¢
à¸œà¸¡à¸à¸´à¸™à¹à¸šà¸šà¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸ˆà¸´à¹‰à¸¡à¸‹à¸­à¸ªà¸à¹‡à¸­à¸£à¹ˆà¸­à¸¢à¸¥à¸°à¸„à¸£à¸±à¸š
à¸–à¹‰à¸²à¸­à¸¢à¹ˆà¸²à¸‡à¸­à¸·à¹ˆà¸™à¸à¹‡à¸ˆà¸°à¹€à¸›à¹‡à¸™à¸¡à¸±à¸™à¸šà¸” à¸—à¸µà¹ˆà¸—à¸³à¹„à¸”à¹‰à¸”à¸µà¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™
à¸«à¸¥à¸²à¸™à¸œà¸¡à¸à¹‡à¸Šà¸­à¸šà¸™à¸±à¸à¸Šà¸­à¸šà¸«à¸™à¸² à¹€à¸ˆà¸­à¸£à¹‰à¸²à¸™à¸™à¸µà¹ˆà¸žà¸¥à¸²à¸”à¹„à¸¡à¹ˆà¹„à¸”à¹‰ à¸œà¸¡à¸ˆà¸°à¸Šà¹ˆà¸§à¸¢à¸à¸´à¸™à¸à¹‡à¸¢à¸¹à¸£à¸´à¸„à¹€à¸à¸´à¸™
"""
def RAKE(title, comment, top_n=5):
    """
    Extract keywords from Thai text using a RAKE(Rapid Automatic Keyword Extraction).
    Using title and comment text
    with title weight = 1 and comment weight = 0.7
    """
    title_clean = clean_text(title)
    comment_clean = clean_text(comment)
    title_tokens = word_tokenize(title_clean, engine='newmm', keep_whitespace=False)
    comment_tokens = word_tokenize(comment_clean, engine='newmm', keep_whitespace=False)
    tokens = title_tokens + comment_tokens
    
    stop_words = pythainlp.corpus.thai_stopwords()
    phases = []
    current_phase = []
    
    for token in tokens:
        if token not in stop_words:
            current_phase.append(token)
        else:
            if len(current_phase) > 0:
                phases.append(current_phase)
            current_phase = []

    degree = {}
    for token in tokens:
        for phase in phases:
            if token in phase:
                if token not in degree:
                    degree[token] = 0
                degree[token] += len(phase) - 1

    
    freq = {}
    for token in tokens:
        for phase in phases:
            for word in phase:
                if token == word:
                    if token not in freq:
                        freq[token] = 0
                    freq[token] += 1
    
    score = {}
    for phase in phases:
        current_score = 0
        for word in phase:
            k = 1 if word in title_tokens else 0.7
            current_score += (degree.get(word, 0) / freq.get(word, 0)) * k
        score["".join(phase)] = current_score
    
    sorted_score = sorted(score.items(), key=lambda x: x[1], reverse=True)
    return [keyword for keyword, _ in sorted_score[:top_n]]

if __name__ == "__main__":
    print(RAKE(title=text_title, comment=text_comment, top_n=5))




